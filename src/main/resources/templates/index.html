<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ReasonForRead</title>
    <style>
        * {
            box-sizing: border-box;
        }

        p {
            margin: 0;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #2b2b2b;
            font-family: "ë‚˜ëˆ”ë°”ë¥¸ê³ ë”•", -apple-system, BlinkMacSystemFont, sans-serif;
            color: #333;
            overflow-x: hidden;
        }

        /* ì „ì²´ ì»¨í…Œì´ë„ˆ */
        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ë©”ì¸ ìƒíƒœ: ì¤‘ì•™ ì •ë ¬ */
        .container.main-state {
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ê²€ìƒ‰ ê²°ê³¼ ìƒíƒœ: ìƒë‹¨ ì •ë ¬ */
        .container.search-state {
            justify-content: flex-start;
            padding-top: 40px;
        }

        /* ë¡œê³  & ì œëª© ì˜ì—­ */
        .header {
            text-align: center;
            margin-bottom: 40px;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-state .header {
            margin-bottom: 30px;
            transform: scale(0.85);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background-color: #f8b58e;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .logo-text {
            font-size: 42px;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: 16px;
            color: #999;
            font-weight: 400;
            margin-top: 8px;
            opacity: 0.85;
        }

        /* ê²€ìƒ‰ì°½ ì»¨í…Œì´ë„ˆ */
        .search-wrapper {
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            padding: 0 20px;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-state .search-wrapper {
            max-width: 900px;
        }

        /* ì…ë ¥ì°½ + ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        .getUserMessage {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* textarea - ëœ ë‘¥ê¸€ê²Œ, ê·¸ë¦¼ì ìµœì†Œí™” */
        .roros {
            width: 100%;
            height: 52px;
            min-height: 52px;
            padding: 14px 20px;
            border-radius: 8px;
            border: 2px solid transparent;
            background-color: #3a3a3a;
            color: #ffffff;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            resize: none;
            overflow-y: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease, height 0.2s ease;
        }

        .roros::placeholder {
            color: #888;
        }

        .roros:focus {
            background-color: #404040;
            border-color: #f8b58e;
            box-shadow: 0 2px 8px rgba(248, 181, 142, 0.25);
            height: auto;
        }

        /* ê²€ìƒ‰ ìƒíƒœì¼ ë•Œ ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        .search-state .roros {
            height: 48px;
            min-height: 48px;
            border-radius: 6px;
            font-size: 14px;
        }

        /* ì „ì†¡ ë²„íŠ¼ - ì¤‘ê°„ ë‘¥ê¸€ê¸° */
        .btngogo {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #f8b58e 0%, #f5a572 100%);
            box-shadow: 0 2px 8px rgba(248, 181, 142, 0.3);
            cursor: pointer;
            font-size: 18px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .btngogo:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 12px rgba(248, 181, 142, 0.4);
            background: linear-gradient(135deg, #f5a572 0%, #f39154 100%);
        }

        .btngogo:active {
            transform: translateY(0);
        }

        /* ì‚¬ìš©ì ì•„ì´ì½˜ */
        .user-icon {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3a3a3a;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-icon:hover {
            background-color: #4a4a4a;
        }

        .user-icon svg {
            width: 20px;
            height: 20px;
            stroke: #f8b58e;
        }

        /* ê²°ê³¼ ì˜ì—­ */
        #resultArea {
            width: 100%;
            max-width: 900px;
            margin: 30px auto 40px;
            padding: 0 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-state #resultArea {
            opacity: 1;
            transform: translateY(0);
        }

        /* ì±… ê²°ê³¼ ë°•ìŠ¤ - ì¹´ë“œë§Œ ê·¸ë¦¼ì ê°•ì¡° */
        .bookBox {
            display: flex;
            gap: 24px;
            padding: 28px;
            margin-bottom: 20px;
            background-color: #3a3a3a;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .bookBox:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.5);
            background-color: #404040;
        }

        /* ì±… ì´ë¯¸ì§€ */
        .bookImg {
            width: 110px;
            height: 160px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* ìš°ì¸¡ ì»¨í…Œì´ë„ˆ */
        .rightContainer {
            display: flex;
            flex-direction: column;
            flex: 1;
            gap: 16px;
        }

        .BooksInfo {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bookTitle {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            line-height: 1.4;
        }

        .bookMetaData {
            color: #999;
            font-size: 13px;
        }

        .hashTag {
            font-size: 13px;
            color: #f8b58e;
            font-weight: 500;
        }

        .bookDescrip {
            font-size: 14px;
            color: #cccccc;
            line-height: 1.6;
            margin-top: 4px;
        }

        .recReason {
            font-size: 14px;
            color: #b0b0b0;
            line-height: 1.6;
            padding: 12px;
            background-color: #2b2b2b;
            border-radius: 8px;
            border-left: 3px solid #f8b58e;
        }

        /* ë²„íŠ¼ - ìœ„ê³„ ë¶„ë¦¬ */
        .buttons {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        /* ë©”ì¸ ë²„íŠ¼ (êµ¬ë§¤í•˜ê¸°) */
        .buttons button {
            padding: 10px 18px;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            background-color: #f8b58e;
            color: #2b2b2b;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .buttons button:hover {
            background-color: #f5a572;
        }

        /* ë³´ì¡° ë²„íŠ¼ (ë¶ë§ˆí¬) */
        .buttons button:last-child {
            background-color: transparent;
            border: 1.5px solid #555;
            color: #ccc;
            box-shadow: none;
        }

        .buttons button:last-child:hover {
            background-color: #333;
            border-color: #666;
            transform: none;
        }

        .buttons a {
            text-decoration: none;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .logo-text {
                font-size: 32px;
            }

            .bookBox {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .bookImg {
                width: 140px;
                height: 200px;
            }

            .buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<!-- ì‚¬ìš©ì ì•„ì´ì½˜ -->
<div class="user-icon">
    <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
    </svg>
</div>

<div class="container main-state">
    <!-- í—¤ë” (ë¡œê³  + ì œëª©) -->
    <div class="header">
        <div class="logo">
            <div class="logo-icon">ğŸ“š</div>
            <span class="logo-text">ReforÉ™R</span>
        </div>
        <p class="subtitle">ë…ì„œì— ì´ìœ ë¥¼ ì–¹ê±°ë‹¤</p>
    </div>

    <!-- ê²€ìƒ‰ì°½ -->
    <div class="search-wrapper">
        <div class="getUserMessage">
            <textarea id="Chat-input" class="roros" placeholder="ê·¸ë˜ë„ ì±…ì€ ì½ì–´ì•¼ í•˜ì§€ ì•Šì„ê¹Œ?"></textarea>
            <button id="gogo" class="btngogo">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="resultArea"></div>
</div>

<script>
    const textarea = document.querySelector(".roros");
    const container = document.querySelector(".container");
    const resultArea = document.querySelector("#resultArea");

    // textarea ìë™ ë†’ì´ ì¡°ì ˆ
    textarea.addEventListener("focus", function() {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
    });

    textarea.addEventListener("input", function() {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
    });

    textarea.addEventListener("blur", function() {
        if (!this.value) {
            this.style.height = "52px";
        }
    });

    // Enter í‚¤ë¡œ ì „ì†¡
    textarea.addEventListener("keypress", function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            getUserMessage();
        }
    });

    let sendbutton = document.querySelector(".btngogo");
    sendbutton.addEventListener('click', getUserMessage);

    function getUserMessage() {
        let message = document.querySelector(".roros");
        let userMessage = message.value.trim();

        if (!userMessage) return;

        sendUserMessage(userMessage);
    }

    function sendUserMessage(message) {
        // ì´ì „ ê²°ê³¼ ì œê±°
        resultArea.innerHTML = '';

        // ê²€ìƒ‰ ìƒíƒœë¡œ ì „í™˜
        container.classList.remove('main-state');
        container.classList.add('search-state');

        let body = JSON.stringify({
            'message': message
        });

        fetch("http://localhost:8080/books", {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: body
        })
            .then((response) => response.json())
            .then((data) => {
                console.log('ì„œë²„ ì‘ë‹µ:', data); // ë””ë²„ê¹…ìš©
                return getBooksFromJSON(data);
            })
            .then((books) => foundBooksInIndex(books))
            .catch((error) => {
                console.error('Error:', error);
                // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                resultArea.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            });
    }

    function getBooksFromJSON(data) {
        return data.items.books;
    }

    function foundBooksInIndex(data) {
        if (!data || data.length === 0) {
            resultArea.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        let len = data.length;

        for (let i = 0; i < len; i++) {
            createElement(data[i]);
        }
    }

    function createElement(book) {
        const booksDiv = document.createElement("div");
        booksDiv.className = "bookBox";

        // ì™¼ìª½ ì´ë¯¸ì§€
        const bookImgDiv = document.createElement("div");
        const bookImg = document.createElement("img");
        bookImg.className = "bookImg";
        bookImg.src = book.image || "https://via.placeholder.com/110x160?text=No+Image";
        bookImgDiv.appendChild(bookImg);

        // ì˜¤ë¥¸ìª½ ì»¨í…Œì´ë„ˆ
        const rightContainer = document.createElement("div");
        rightContainer.className = "rightContainer";

        // ì±… ì •ë³´
        const bookInfo = document.createElement("div");
        bookInfo.className = "BooksInfo";

        const bookTitle = document.createElement("div");
        bookTitle.className = "bookTitle";
        bookTitle.textContent = book.title;

        const bookMetaData = document.createElement("div");
        bookMetaData.className = "bookMetaData";
        bookMetaData.textContent = `${book.author} | ${book.publisher} ì¶œíŒ | ${book.pubdate}`;

        const tags = document.createElement("p");
        tags.className = "hashTag";
        tags.textContent = (book.tag || []).join(" ");

        const description = document.createElement("p");
        description.className = "bookDescrip";
        description.textContent = book.description;

        const recReason = document.createElement("p");
        recReason.className = "recReason";
        recReason.textContent = book.reason;

        bookInfo.appendChild(bookTitle);
        bookInfo.appendChild(bookMetaData);
        if (tags.textContent) bookInfo.appendChild(tags);
        bookInfo.appendChild(description);
        bookInfo.appendChild(recReason);

        // ë²„íŠ¼
        const buttons = document.createElement("div");
        buttons.className = "buttons";

        const buyButton = document.createElement("button");
        buyButton.textContent = "ì±… êµ¬ë§¤í•˜ê¸°";

        // linkê°€ ìˆìœ¼ë©´ a íƒœê·¸ë¡œ ê°ì‹¸ê¸°
        if (book.link) {
            const buyButtonSrc = document.createElement("a");
            buyButtonSrc.href = book.link;
            buyButtonSrc.target = "_blank";
            buyButtonSrc.appendChild(buyButton);
            buttons.appendChild(buyButtonSrc);
        } else {
            buttons.appendChild(buyButton);
        }

        const bookMarkButton = document.createElement("button");
        bookMarkButton.textContent = "ë¶ë§ˆí¬í•˜ê¸°";

        buttons.appendChild(bookMarkButton);

        rightContainer.appendChild(bookInfo);
        rightContainer.appendChild(buttons);

        booksDiv.appendChild(bookImgDiv);
        booksDiv.appendChild(rightContainer);

        resultArea.appendChild(booksDiv);
    }
</script>
</body>
</html>